# 快捷键重复检测功能

## 功能描述

为LinkCore下载管理器添加了快捷键重复检测功能，防止用户设置重复的快捷键。

## 实现的功能

1. **重复检测**: 当用户尝试设置一个已被其他命令使用的快捷键时，系统会检测到冲突
2. **友好提示**: 显示通知消息，告知用户哪个命令正在使用该快捷键
3. **阻止重复**: 不允许设置重复的快捷键，保持界面简洁流畅
4. **多语言支持**: 支持中文简体、中文繁体和英文

## 修改的文件

### 1. 本地化文件
- `src/shared/locales/zh-CN/preferences.js` - 简体中文
- `src/shared/locales/zh-TW/preferences.js` - 繁体中文  
- `src/shared/locales/en-US/preferences.js` - 英文

添加的本地化键值：
- `shortcut-duplicate-message`: 重复快捷键的提示消息

### 2. 主要组件
- `src/renderer/components/Preference/Basic.vue`

修改的方法：
- `setCommandKeystroke()`: 添加重复检测逻辑和通知提示
- `getCommandByKeystroke()`: 新增方法，根据快捷键查找命令
- `getCurrentKeymap()`: 新增方法，构建当前完整的快捷键映射

## 工作流程

1. 用户在快捷键设置界面按下新的快捷键
2. 系统调用 `setCommandKeystroke()` 方法
3. 检查该快捷键是否已被其他命令使用
4. 如果有冲突：
   - 显示警告通知，告知用户冲突信息
   - 阻止设置重复快捷键
5. 如果没有冲突：
   - 应用新的快捷键设置
   - 自动保存配置

## 技术细节

- **实时映射构建**: `getCurrentKeymap()` 方法动态构建当前的完整快捷键映射
  - 从默认快捷键开始
  - 移除被自定义快捷键覆盖的默认绑定
  - 应用所有自定义快捷键
- **冲突检测**: `getCommandByKeystroke()` 使用实时映射进行检测
- **冲突处理**: 使用Element UI的消息通知组件
- **数据更新**: 使用Vue的响应式数据更新机制
- **自动保存**: 修改后自动触发保存机制
- **插值语法**: 使用正确的i18next插值语法 `{{variable}}` 而不是 `{variable}`

## 用户体验

- 简洁的通知提示，不打断用户操作流程
- 清晰的冲突信息显示，告知具体的冲突命令和快捷键
- 阻止重复设置，保持快捷键的唯一性
- 支持多语言界面，提供本地化体验

## 修复记录

- **插值语法修复**: 修正了本地化文件中的插值语法，从 `{variable}` 改为 `{{variable}}`，以符合项目使用的i18next库的要求
- **显示效果**: 现在快捷键和命令名称会正确显示在提示消息中
- **HTML转义问题修复**: 将快捷键显示中的 `Ctrl/Cmd` 改为 `Ctrl或Cmd`，避免斜杠被HTML转义为 `&#x2F;`
- **实时检测修复**: 修复了重复检测不能实时反映快捷键修改的问题，现在会正确构建当前的快捷键映射状态

## 修复前后对比

### 修复前的问题
1. 用户将命令A的快捷键从 `Ctrl+A` 改为 `Ctrl+B`
2. 用户尝试将命令B的快捷键设置为 `Ctrl+A`
3. 系统错误地提示 `Ctrl+A` 仍被命令A使用（实际上已经不使用了）

### 修复后的行为
1. 用户将命令A的快捷键从 `Ctrl+A` 改为 `Ctrl+B`
2. 系统实时更新快捷键映射，`Ctrl+A` 被释放
3. 用户可以正常将命令B的快捷键设置为 `Ctrl+A`
4. 只有在真正冲突时才会显示警告

### 核心改进
- **实时状态**: 快捷键检测基于当前实际状态，而不是初始状态
- **正确覆盖**: 自定义快捷键正确覆盖默认快捷键
- **动态更新**: 每次检测都重新构建完整的快捷键映射